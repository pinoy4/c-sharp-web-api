# C# Web API

This project is meant to test and combine the most common features of a web API.
It is made up of a web app in `C#` and a database running `postgresql`.

# SETUP

#### Start
To start the database run `docker-compose up` in the terminal from the root folder of the project. This will start two containers:

- postgres: runs the database;  
    username=`mwtest`, password=`mwtest`, port=`5432`, database=`mwtest`
- pgadmin: eases access to the database. It is reachable at `localhost:5050`;  
    username=`pgadmin4@pgadmin.org`, password=`admin`
    
#### Migrations
To run migrations execute `dotnet ef database update` in the terminal from the root folder of the project.

# FEATURES:

- [x] database connection
- [x] database migrations
- [ ] automatic swagger documentation
- [ ] authentication
- [ ] authorization

# HOW TO
Here is a list of things that have been included in the project. This is not meant as a tutorial but as a quick reference for understanding what has gone into creating the project. Hopefully this will be useful when trying to replicate these features.

#### Postgresql connection

- Add dependencies `Npgsql.EntityFrameworkCore.PostgreSQL` and `Npgsql.EntityFrameworkCore.PostgreSQL.Design`
- Create the database `DbContext` class (`MWTestDb.cs`) with only the constructor
- Add the `ConnectionStrings` key in the `appsettings.json` file
- Add the `Configuration` property in `Startup` and add it to the constructor
- In the `ConfigureServices` method of `Startup` add the database service
- [npgsql documetation](http://www.npgsql.org/efcore/index.html)

#### Database model

- Create a class to represent a model (`User.cs`). Use annotations to specify constraints on the properties
- Add a `DbSet` of the model type to the `DbContext` (`MWTestDb.cs`)
- [microsoft documentation](https://docs.microsoft.com/en-gb/ef/core/get-started/aspnetcore/new-db?view=aspnetcore-2.1#create-the-model)

#### Database migrations
These migrations are generated by a tool starting from the database model in the code. When generating a migration a snapshot is created along with the actual migration and it is used to build the next migration.

- Manually add the `Microsoft.EntityFrameworkCore.Tools.DotNet` dependency to the `*.csproj` file.
- From the CLI run `dotnet ef migrations add migration_name` to generate the first migration (change `migration_name` to whatever you want to name the migration)
- [microsoft documentation](https://docs.microsoft.com/en-us/aspnet/core/data/ef-mvc/migrations?view=aspnetcore-2.1)